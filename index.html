<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Peptide Calculator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f0f12;--card:#15161a;--ink:#e7e7ea;--muted:#9aa0ab;
    --accent:#7c5cff;--accent-2:#25d0a6;--error:#ff6b6b;

    /* SUBQ barrel overlay defaults (percentages relative to the *image box*) */
    --b-left: 40.0%;     /* where barrel starts, % from image left */
    --b-right: 30.0%;    /* where barrel ends, % from image right */
    --b-top: 46.0%;      /* top position of barrel, % from image top */
    --b-height: 12.0%;   /* height of barrel, % of image height */

    /* small pixel nudge of entire overlay (rarely needed) */
    --barrel-shift-x: 0px;
    --barrel-shift-y: 0px;
  }

  *{box-sizing:border-box}
  html{-webkit-text-size-adjust:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:radial-gradient(1100px 700px at 100% -50%, #1b1c22 30%, #0f0f12 70%),var(--bg);
    color:var(--ink)
  }

  /* hero */
  .hero{max-width:100%;height:auto;display:block;margin:0 auto 12px auto}

  .wrap{max-width:1080px;margin:auto;padding:24px}
  header{display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:18px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:46px;height:46px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#0d0e12;border:1px solid #2a2c33}
  .logo img{width:100%;height:100%;object-fit:contain;display:block}
  h1{font-size:clamp(22px,3vw,32px);margin:0;font-weight:800;letter-spacing:-0.02em}

  .card{
    background:linear-gradient(180deg, #1a1b21, #131419);
    border:1px solid #23242b;
    box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);
    border-radius:16px;padding:18px
  }
  .grid{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}

  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  .row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
  .field{grid-column:span 6}
  .field.sm{grid-column:span 4}
  .field.dose{grid-column:span 8}
  @media (max-width:900px){ .field.dose{grid-column:span 12} }

  .input{
    width:100%;background:#0d0e12;color:var(--ink);
    border:1px solid #2a2c33;border-radius:12px;
    padding:12px 14px;font-size:16px;line-height:1.3;min-height:46px;
    caret-color:#fff;outline:2px solid transparent;outline-offset:2px;
    transition:border .15s ease, outline .15s ease;text-align:left;
  }
  .input:focus{border-color:#5c6ae6;outline-color:#3d44a3}

  .dose-group{display:grid;grid-template-columns:1fr 110px;gap:8px}
  .unit-select{width:110px;min-height:46px;font-size:16px}
  @media (max-width:420px){
    .dose-group{grid-template-columns:1fr 96px}
    .unit-select{width:96px}
  }

  input[type="number"]{
    appearance:textfield;-webkit-appearance:textfield;
    -webkit-text-fill-color: var(--ink); color: var(--ink); background-color:#0d0e12;
  }
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
  ::placeholder{color:var(--muted);opacity:.8}

  .btns{display:flex;flex-wrap:wrap;gap:10px}
  button.pill{background:#0d0e12;border:1px solid #2a2c33;color:var(--ink);padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:600}
  button.pill[aria-pressed="true"],button.pill:hover{border-color:#4d8cff;background:#111424}

  .muted{color:var(--muted)}
  .big{font-size:clamp(18px,3vw,24px);font-weight:800}

  /* visual tabs */
  .tabs{display:flex;gap:8px;margin:4px 0 10px}
  .tabs .pill{padding:8px 12px}

  /* Classic syringe */
  .syringe{background:#0c0d11;border:1px solid #272930;border-radius:14px;padding:18px}
  .syringe h3{margin:0 0 10px 0;font-size:18px}
  .tube{position:relative;height:36px;border-radius:18px;background:linear-gradient(180deg,#11131a,#0b0c10);border:1px solid #2a2c33;box-shadow:inset 0 2px 8px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05)}
  .fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg, var(--accent), #5b9dff);border-radius:18px;box-shadow:inset 0 0 12px rgba(255,255,255,.25), 0 0 16px rgba(124,92,255,.45)}
  .cap{position:absolute;left:-8px;top:50%;translate:0 -50%;width:18px;height:18px;border-radius:50%;background:linear-gradient(180deg,#4e556a,#262a33);border:1px solid #6b7388}
  .ticks{position:relative;display:flex;justify-content:space-between;align-items:flex-start;margin-top:10px;padding:0 2px}
  .tick{position:relative;width:1px;background:#3a3d47}
  .tick.minor{height:10px;opacity:.55}
  .tick.major{height:16px}
  .tick .n{position:absolute;top:18px;left:50%;transform:translateX(-50%);font-size:12px;color:var(--muted)}
  .cursor{position:absolute;top:-8px;width:2px;background:var(--accent-2);height:52px;border-radius:2px;box-shadow:0 0 0 2px rgba(37,208,166,.15)}

  .note{font-size:13px;color:var(--muted)}
  .result{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:26px}
  .chip{background:#0c0d11;border:1px solid #2a2c33;border-radius:12px;padding:10px 12px}
  .chip .k{color:var(--muted);font-size:12px}
  .chip .v{font-weight:800;font-size:18px}
  .warn{color:var(--error);font-weight:700}
  footer{margin-top:26px;color:var(--muted);font-size:12px}
  a{color:#8fb6ff}

  /* SUBQ syringe stage (image + overlay that sticks to image rect) */
  .stage{background:#0c0d11;border:1px solid #272930;border-radius:14px;padding:14px}
  .subq-stage{position:relative;width:100%;aspect-ratio: 16/6; /* nice wide hero */ }
  .subq-img{width:100%;height:100%;object-fit:contain;display:block;user-select:none;pointer-events:none}
  .subq-overlay{
    position:absolute;left:0;top:0;width:100%;height:100%;
    pointer-events:none; /* so UI behind remains clickable */
    /* we size/move this to the image’s *rendered* box via JS */
  }

  /* The internal barrel inside overlay uses % that are relative to the overlay,
     which we've matched to the image’s true pixel box, so it won't drift. */
  .subq-overlay .barrel{
    position:absolute;
    left:  calc(var(--b-left)  );
    right: calc(var(--b-right) );
    top:   calc(var(--b-top)   );
    height:calc(var(--b-height));
    transform: translate(var(--barrel-shift-x), var(--barrel-shift-y));
    display:flex;align-items:center;
  }
  .subq-overlay .barrel .track{
    position:relative;width:100%;height:100%;
    border-radius:10px;overflow:hidden;
    /* subtle glass */
    background:linear-gradient(180deg,#0f1117,#0b0c10);
    border:1px solid #2a2c33;
    box-shadow:inset 0 2px 8px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05);
  }
  .subq-overlay .barrel .fill{
    position:absolute;left:0;top:0;bottom:0;width:0%;
    background:linear-gradient(90deg, var(--accent), #5b9dff);
    box-shadow:inset 0 0 12px rgba(255,255,255,.25), 0 0 16px rgba(124,92,255,.45);
  }
  .subq-overlay .barrel .thumb{
    position:absolute;left:0;top:50%;transform:translate(-45%, -50%);
    width:34px;height:34px;border-radius:50%;
    background:linear-gradient(180deg,#4e556a,#262a33);border:1px solid #6b7388;
    box-shadow:0 6px 16px rgba(0,0,0,.35);
  }
  .subq-overlay .tickrow{
    position:absolute;left:0;right:0;height:44%;
    top:6%; /* sits a bit above centerline */
    pointer-events:none;
  }
  .subq-overlay .tickrow .t{position:absolute;width:1px;background:#3a3d47}
  .subq-overlay .tickrow .t.major{height:60%}
  .subq-overlay .tickrow .t.minor{height:35%;opacity:.55}
  .subq-overlay .tickrow .n{
    position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);
    font-size:11px;color:#8c93a3
  }

  /* Debug HUD */
  .hud{
    position:fixed;left:12px;bottom:12px;z-index:9999;
    background:#0b0c10cc;border:1px solid #2a2c33;border-radius:12px;
    padding:10px 12px;color:#dfe2ea;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size:14px;line-height:1.35;backdrop-filter: blur(6px);
    display:none;
  }
  .hud kbd{background:#1b1d24;border:1px solid #2f3240;border-radius:6px;padding:2px 6px;margin:0 2px;font-weight:700}
  .hud .row{display:flex;gap:14px;flex-wrap:wrap}
</style>
</head>
<body>

<!-- Hero banner -->
<img class="hero" src="IMG_20250926_184644.png" alt="SUBQ SOCIETY – THE UNDERGROUND PROTOCOL">

<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo"><img src="IMG_20250926_184642.png" alt="Snake syringe logo"/></div>
      <h1>Peptide Calculator</h1>
    </div>
  </header>

  <div class="grid">
    <!-- LEFT: Inputs -->
    <section class="card" aria-labelledby="inputsTitle">
      <h2 id="inputsTitle" class="big" style="margin:6px 0 12px">Setup</h2>

      <div class="row">
        <div class="field sm">
          <label for="vialMg">Peptide per vial (mg)</label>
          <input id="vialMg" class="input" type="number" step="0.1" value="5"/>
        </div>
        <div class="field sm">
          <label for="diluentMl">Diluent added (mL)</label>
          <input id="diluentMl" class="input" type="number" step="0.1" value="1"/>
        </div>
        <div class="field sm">
          <label for="syrSize">Syringe size (units scale)</label>
          <select id="syrSize" class="input">
            <option value="30">30-unit (short)</option>
            <option value="50">50-unit</option>
            <option value="100" selected>100-unit</option>
          </select>
        </div>

        <!-- Desired dose -->
        <div class="field sm dose">
          <label for="doseVal">Desired dose</label>
          <div class="dose-group">
            <input id="doseVal" class="input" type="number" step="0.001" min="0" value="0.5" inputmode="decimal" placeholder="Enter dose"/>
            <select id="doseUnit" class="input unit-select">
              <option value="mcg">mcg</option>
              <option value="mg" selected>mg</option>
            </select>
          </div>
        </div>
      </div>

      <div style="margin-top:10px">
        <label>Quick select dose</label>
        <div id="presets-mcg" class="btns" role="group" aria-label="Preset doses (mcg)" style="display:none">
          <button class="pill preset" data-dose="50" data-unit="mcg" aria-pressed="true">50 mcg</button>
          <button class="pill preset" data-dose="100" data-unit="mcg">100 mcg</button>
          <button class="pill preset" data-dose="250" data-unit="mcg">250 mcg</button>
          <button class="pill preset" data-dose="500" data-unit="mcg">500 mcg</button>
        </div>
        <div id="presets-mg" class="btns" role="group" aria-label="Preset doses (mg)">
          <button class="pill preset" data-dose="1" data-unit="mg" aria-pressed="true">1 mg</button>
          <button class="pill preset" data-dose="2" data-unit="mg">2 mg</button>
          <button class="pill preset" data-dose="5" data-unit="mg">5 mg</button>
          <button class="pill preset" data-dose="10" data-unit="mg">10 mg</button>
        </div>
      </div>

      <p class="note" style="margin-top:10px">Assumes a U-100 insulin syringe where <strong>1 unit = 0.01 mL</strong>. Calculations update as you type.</p>
    </section>

    <!-- RIGHT: Visuals -->
    <section class="card" aria-labelledby="visTitle">
      <h2 id="visTitle" class="big" style="margin:6px 0 8px">Visual Aid</h2>

      <div class="tabs">
        <button class="pill" id="tabSubq" aria-pressed="true">SUBQ Syringe</button>
        <button class="pill" id="tabClassic" aria-pressed="false">Classic</button>
      </div>

      <h3 id="headline" style="margin:0 0 10px 0;font-size:18px">To have a dose of <span id="doseOut">0.5</span> <span id="doseUnitLabel">mg</span> pull the syringe to <span id="unitsOut">—</span> <span id="unitWord">units</span></h3>

      <!-- SUBQ stage -->
      <div id="subqCard" class="stage">
        <div class="subq-stage" id="subqStage">
          <img id="subqImg" class="subq-img" src="IMG_20250928_220440.png" alt="SUBQ syringe">
          <div id="subqOverlay" class="subq-overlay">
            <div class="barrel" id="barrel">
              <div class="track">
                <div class="fill" id="subqFill"></div>
                <div class="thumb" id="subqThumb"></div>
                <div class="tickrow" id="subqTicks"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Classic card (hidden initially) -->
      <div id="classicCard" class="syringe" style="display:none">
        <div class="tube">
          <div class="fill" id="fill"></div>
          <div class="cap" aria-hidden="true"></div>
          <div class="cursor" id="cursor" aria-hidden="true"></div>
        </div>
        <div class="ticks" id="ticks" aria-hidden="true"></div>
      </div>

      <div class="result">
        <div class="chip">
          <div class="k">Units to pull</div>
          <div class="v" id="unitsOutChip">—</div>
          <div class="k" style="margin-top:4px">≈ <span id="mlOut">—</span></div>
        </div>
        <div class="chip">
          <div class="k">Potency</div>
          <div class="v" id="potencyOut">—</div>
          <div class="k"><span id="potencyUnitLabel">mg</span> per unit</div>
        </div>
      </div>
      <p id="warn" class="note" style="margin-top:8px"></p>

      <footer><p class="note">This calculator is for educational use only. Not medical advice.</p></footer>
    </section>
  </div>
</div>

<!-- Developer HUD -->
<div class="hud" id="hud">
  <div><strong>Debug mode</strong> — Press <kbd>D</kbd> to toggle</div>
  <div class="row" style="margin-top:6px">
    <div>Move: <kbd>←</kbd>/<kbd>→</kbd>/<kbd>↑</kbd>/<kbd>↓</kbd> (hold <kbd>Shift</kbd> for ×4)</div>
  </div>
  <div class="row">
    <div>Left%: <kbd>;</kbd> / <kbd>'</kbd></div>
    <div>Right%: <kbd>[</kbd> / <kbd>]</kbd></div>
    <div>Top%: <kbd>,</kbd> / <kbd>.</kbd></div>
    <div>Height%: <kbd>-</kbd> / <kbd>=</kbd></div>
  </div>
  <div id="hudVals" style="margin-top:6px"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const $ = id => document.getElementById(id);
  const root = document.documentElement;

  /* ====== Inputs & Outputs ====== */
  const vialMg = $('vialMg'), diluentMl=$('diluentMl'), syrSize=$('syrSize');
  const doseVal=$('doseVal'), doseUnit=$('doseUnit');
  const presetsMcg=$('presets-mcg'), presetsMg=$('presets-mg');

  const doseOut=$('doseOut'), doseUnitLabel=$('doseUnitLabel');
  const unitsOut=$('unitsOut'), unitWord=$('unitWord'), mlOut=$('mlOut');
  const potencyOut=$('potencyOut'), potencyUnitLabel=$('potencyUnitLabel');
  const unitsOutChip=$('unitsOutChip'), warnEl=$('warn');
  const headline=$('headline');

  /* ====== Classic visual elems ====== */
  const ticksClassic=$('ticks'), fillClassic=$('fill'), cursorClassic=$('cursor');

  /* ====== SUBQ elements ====== */
  const stage=$('subqStage'), img=$('subqImg'), overlay=$('subqOverlay');
  const barrel=$('barrel'), subqFill=$('subqFill'), subqThumb=$('subqThumb'), subqTicks=$('subqTicks');

  /* ====== Tabs ====== */
  const tabSubq=$('tabSubq'), tabClassic=$('tabClassic');
  const subqCard=$('subqCard'), classicCard=$('classicCard');

  /* ====== Helpers ====== */
  const clamp=(n,min,max)=>Math.min(max,Math.max(min,n));
  const fmt=(n,d=2)=>Number.isFinite(n)?n.toFixed(d).replace(/\.0+$/,'').replace(/(\.[1-9]*)0+$/,'$1'):'—';

  /* ====== Classic ticks ====== */
  function buildClassicTicks(){
    ticksClassic.innerHTML='';
    const max=parseInt(syrSize.value,10)||30;
    const minorStep=(max<=30?1:5), majorStep=(max<=30?5:10);
    for(let i=0;i<=max;i+=minorStep){
      const t=document.createElement('div');
      t.className='tick '+(i%majorStep===0?'major':'minor');
      if(i%majorStep===0){
        const n=document.createElement('div'); n.className='n'; n.textContent=String(i); t.appendChild(n);
      }
      ticksClassic.appendChild(t);
    }
  }

  /* ====== SUBQ overlay alignment (anchor to image box) ====== */
  function syncOverlayToImageBox(){
    const imgRect   = img.getBoundingClientRect();
    const stageRect = stage.getBoundingClientRect();
    overlay.style.left   = (imgRect.left - stageRect.left) + 'px';
    overlay.style.top    = (imgRect.top  - stageRect.top)  + 'px';
    overlay.style.width  = imgRect.width  + 'px';
    overlay.style.height = imgRect.height + 'px';
  }

  const ro = new ResizeObserver(syncOverlayToImageBox);
  ro.observe(stage); ro.observe(img);
  window.addEventListener('resize', syncOverlayToImageBox);
  img.decode?.().then(syncOverlayToImageBox).catch(()=>{});
  syncOverlayToImageBox();

  /* ====== SUBQ ticks inside barrel (0..N) ====== */
  function buildSubqTicks(){
    subqTicks.innerHTML='';
    const max=parseInt(syrSize.value,10)||30;
    const count=max; // 0..max
    for(let i=0;i<=count;i++){
      const x=i/count*100;
      const t=document.createElement('div');
      t.className='t ' + (i%10===0?'major':'minor');
      t.style.left = x+'%';
      t.style.bottom='0';
      subqTicks.appendChild(t);
      if(i%10===0){
        const n=document.createElement('div');
        n.className='n'; n.textContent=String(i);
        n.style.left='0'; t.appendChild(n);
      }
    }
  }

  /* ====== Unit toggle / presets ====== */
  function togglePresetRows(){
    const useMg = (doseUnit.value==='mg');
    presetsMg.style.display = useMg?'flex':'none';
    presetsMcg.style.display= useMg?'none':'flex';
    doseUnitLabel.textContent = useMg?'mg':'mcg';
    potencyUnitLabel.textContent=useMg?'mg':'mcg';
  }

  function convertOnUnitChange(prev,next){
    const val=parseFloat(doseVal.value);
    if(!Number.isFinite(val)||prev===next) return;
    if(prev==='mcg'&&next==='mg') doseVal.value=(val/1000).toString();
    else if(prev==='mg'&&next==='mcg') doseVal.value=(val*1000).toString();
  }

  function wirePresets(row){
    row.querySelectorAll('.preset').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.preset').forEach(b=>b.setAttribute('aria-pressed','false'));
        btn.setAttribute('aria-pressed','true');
        doseUnit.value=btn.dataset.unit;
        doseVal.value=btn.dataset.dose;
        togglePresetRows(); recalc();
      });
    });
  }

  /* ====== Math & visuals ====== */
  function getDesiredDoseMcg(){
    const val=parseFloat(doseVal.value);
    if(!Number.isFinite(val)||val<=0) return NaN;
    return (doseUnit.value==='mg') ? val*1000 : val;
  }

  function recalc(){
    const mg=parseFloat(vialMg.value), ml=parseFloat(diluentMl.value);
    const maxUnits=parseInt(syrSize.value,10)||30;
    const conc=(mg>0&&ml>0)?(mg/ml):NaN;       // mg/mL
    const mcgPerUnit=Number.isFinite(conc)? conc*10 : NaN; // mcg per unit (U-100)
    const mgPerUnit=Number.isFinite(mcgPerUnit)? mcgPerUnit/1000 : NaN;

    const desiredMcg=getDesiredDoseMcg();
    const units=(Number.isFinite(mcgPerUnit)&&Number.isFinite(desiredMcg))? (desiredMcg/mcgPerUnit):NaN;
    const mlToPull=Number.isFinite(units)? units*0.01 : NaN;

    // Header text
    if(doseUnit.value==='mg'){
      doseOut.textContent=fmt(desiredMcg/1000,3);
      doseUnitLabel.textContent='mg';
      potencyOut.textContent=Number.isFinite(mgPerUnit)?fmt(mgPerUnit,4):'—';
      potencyUnitLabel.textContent='mg';
    }else{
      doseOut.textContent=fmt(desiredMcg,0);
      doseUnitLabel.textContent='mcg';
      potencyOut.textContent=Number.isFinite(mcgPerUnit)?fmt(mcgPerUnit,2):'—';
      potencyUnitLabel.textContent='mcg';
    }
    unitsOut.textContent=fmt(units,2);
    unitsOutChip.textContent=Number.isFinite(units)?fmt(units,2):'—';
    mlOut.textContent=Number.isFinite(mlToPull)?`${fmt(mlToPull,3)} mL`:'—';
    if(Number.isFinite(units)) unitWord.textContent=Math.abs(units-1)<0.005?'unit':'units';

    // Classic visuals
    const pct=Number.isFinite(units)?clamp(units/maxUnits*100,0,100):0;
    fillClassic.style.width=pct+'%';
    cursorClassic.style.left=`calc(${pct}% - 1px)`;

    // SUBQ fill/thumb inside overlay
    subqFill.style.width=pct+'%';
    subqThumb.style.left=`calc(${pct}% + 0px)`;

    // headline (kept for accessibility)
    headline.querySelector('#unitsOut').textContent = fmt(units,2);

    // warnings
    warnEl.textContent=''; warnEl.classList.remove('warn');
    if(!Number.isFinite(units)){
      warnEl.textContent='Enter positive values for vial mg, diluent mL, and dose.';
    } else if(units>maxUnits){
      warnEl.textContent=`⚠️ Dose exceeds the selected syringe scale of ${maxUnits} units.`; warnEl.classList.add('warn');
    }
  }

  /* ====== Events ====== */
  ['input','change'].forEach(evt=>{
    [vialMg,diluentMl,syrSize,doseVal].forEach(el=>{
      el.addEventListener(evt,()=>{
        if(el!==doseVal){ document.querySelectorAll('.preset').forEach(b=>b.setAttribute('aria-pressed','false')); }
        if(el===syrSize){ buildClassicTicks(); buildSubqTicks(); }
        recalc();
      });
    });
  });

  doseUnit.addEventListener('change',()=>{
    const prev=(doseUnit.dataset.prev||'mcg'), next=doseUnit.value;
    convertOnUnitChange(prev,next); doseUnit.dataset.prev=next;
    togglePresetRows(); document.querySelectorAll('.preset').forEach(b=>b.setAttribute('aria-pressed','false'));
    recalc();
  });

  wirePresets(presetsMcg); wirePresets(presetsMg);

  // Tabs
  function showSubq(){ subqCard.style.display='block'; classicCard.style.display='none'; tabSubq.setAttribute('aria-pressed','true'); tabClassic.setAttribute('aria-pressed','false'); }
  function showClassic(){ subqCard.style.display='none'; classicCard.style.display='block'; tabSubq.setAttribute('aria-pressed','false'); tabClassic.setAttribute('aria-pressed','true'); }
  tabSubq.addEventListener('click', showSubq);
  tabClassic.addEventListener('click', showClassic);

  /* ====== Developer HUD & Keys ====== */
  const hud=$('hud'), hudVals=$('hudVals');
  let debugOn=false;
  function updateHud(){
    const v=(n)=>getComputedStyle(root).getPropertyValue(n).trim();
    hudVals.textContent = `--b-left: ${v('--b-left')} | --b-right: ${v('--b-right')} | --b-top: ${v('--b-top')} | --b-height: ${v('--b-height')} | --barrel-shift-x: ${v('--barrel-shift-x')} | --barrel-shift-y: ${v('--barrel-shift-y')}`;
  }
  function nudgeVarPercent(name,delta){
    const cur=parseFloat(getComputedStyle(root).getPropertyValue(name))||0;
    root.style.setProperty(name, (cur+delta).toFixed(2)+'%'); updateHud();
  }
  function nudgeVarPx(name,delta){
    const cur=parseFloat(getComputedStyle(root).getPropertyValue(name))||0;
    root.style.setProperty(name, (cur+delta)+'px'); updateHud();
  }

  window.addEventListener('keydown',(e)=>{
    if(e.key.toLowerCase()==='d'){ debugOn=!debugOn; hud.style.display=debugOn?'block':'none'; updateHud(); return; }
    if(!debugOn) return;

    const fast=e.shiftKey?4:1;

    // pixel nudges
    if(e.key==='ArrowLeft'){ nudgeVarPx('--barrel-shift-x', -1*fast); }
    if(e.key==='ArrowRight'){ nudgeVarPx('--barrel-shift-x',  1*fast); }
    if(e.key==='ArrowUp'){ nudgeVarPx('--barrel-shift-y',   -1*fast); }
    if(e.key==='ArrowDown'){ nudgeVarPx('--barrel-shift-y',  1*fast); }

    // % width & position controls
    if(e.key===';'){ nudgeVarPercent('--b-left', -0.1*fast); }
    if(e.key==="'"){ nudgeVarPercent('--b-left',  0.1*fast); }

    if(e.key==='['){ nudgeVarPercent('--b-right', -0.1*fast); }
    if(e.key===']'){ nudgeVarPercent('--b-right',  0.1*fast); }

    if(e.key===','){ nudgeVarPercent('--b-top', -0.1*fast); }
    if(e.key==='.') { nudgeVarPercent('--b-top',  0.1*fast); }

    if(e.key==='-'){ nudgeVarPercent('--b-height', -0.1*fast); }
    if(e.key==='='){ nudgeVarPercent('--b-height',  0.1*fast); }
  });

  /* ====== Init ====== */
  doseUnit.dataset.prev=doseUnit.value;
  buildClassicTicks(); buildSubqTicks();
  togglePresetRows(); recalc();
  showSubq(); // default tab
});
</script>
</body>
</html>
