<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peptide Calculator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0f0f12;--card:#15161a;--ink:#e7e7ea;--muted:#9aa0ab;--accent:#7c5cff;--accent-2:#25d0a6;--error:#ff6b6b; }
    *{box-sizing:border-box}
    html{-webkit-text-size-adjust:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1100px 700px at 100% -50%, #1b1c22 30%, #0f0f12 70%),var(--bg);color:var(--ink)}
    .wrap{max-width:1080px;margin:auto;padding:24px}
    header{display:flex;gap:14px;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:46px;height:46px;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#0d0e12;border:1px solid #2a2c33}
    .logo img{width:100%;height:100%;object-fit:contain;display:block}
    h1{font-size:clamp(22px,3vw,32px);margin:0;font-weight:800;letter-spacing:-0.02em}

    .card{background:linear-gradient(180deg, #1a1b21, #131419);border:1px solid #23242b;box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.03);border-radius:16px;padding:18px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}

    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
    .field{grid-column:span 6}
    .field.sm{grid-column:span 4}

    .input{
      width:100%;
      background:#0d0e12;
      color:var(--ink);
      border:1px solid #2a2c33;
      border-radius:12px;
      padding:12px 14px;
      font-size:16px;           /* mobile: prevents iOS zoom & tiny text */
      line-height:1.3;
      min-height:46px;          /* touch-friendly height */
      caret-color:#fff;
      outline:2px solid transparent;
      outline-offset:2px;
      transition:border .15s ease, outline .15s ease;
      text-align:left;
    }
    .input:focus{border-color:#5c6ae6;outline-color:#3d44a3}

    /* Dose input + unit dropdown layout */
    .dose-group{display:grid;grid-template-columns:1fr 110px;gap:8px}
    .unit-select{width:110px;min-height:46px;font-size:16px}

    /* >>> NEW: Make the Desired dose field wider <<< */
    .field.dose { grid-column: span 8; }            /* desktop/tablet: ~2/3 width */
    @media (max-width: 900px) {
      .field.dose { grid-column: span 12; }         /* phones: full width */
    }
    /* >>> NEW: Give input more space vs the unit select on very narrow phones <<< */
    @media (max-width: 420px) {
      .dose-group { grid-template-columns: 1fr 96px; }
      .unit-select { width: 96px; }
    }

    /* Make sure number text always renders (Android/WebKit quirk) */
    input[type="number"]{
      appearance:textfield;
      -webkit-appearance:textfield;
      -webkit-text-fill-color: var(--ink); /* <-- critical fix */
      color: var(--ink);
      background-color:#0d0e12;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}

    /* Placeholder styling for visibility */
    ::placeholder{color:var(--muted);opacity:.8}
    :-ms-input-placeholder{color:var(--muted)}
    ::-ms-input-placeholder{color:var(--muted)}

    /* Autofill color on Android/Chrome */
    input:-webkit-autofill{
      -webkit-text-fill-color: var(--ink) !important;
      transition: background-color 9999s ease-in-out 0s;
    }

    .btns{display:flex;flex-wrap:wrap;gap:10px}
    button.pill{background:#0d0e12;border:1px solid #2a2c33;color:var(--ink);padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:600}
    button.pill[aria-pressed="true"],button.pill:hover{border-color:#4d8cff;background:#111424}

    .muted{color:var(--muted)}
    .big{font-size:clamp(18px,3vw,24px);font-weight:800}

    /* Syringe visual */
    .syringe{background:#0c0d11;border:1px solid #272930;border-radius:14px;padding:18px}
    .syringe h3{margin:0 0 10px 0;font-size:18px}
    .tube{position:relative;height:36px;border-radius:18px;background:linear-gradient(180deg,#11131a,#0b0c10);border:1px solid #2a2c33;box-shadow:inset 0 2px 8px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.05)}
    .fill{position:absolute;left:0;top:0;bottom:0;width:0%;background:linear-gradient(90deg, var(--accent), #5b9dff);border-radius:18px;box-shadow:inset 0 0 12px rgba(255,255,255,.25), 0 0 16px rgba(124,92,255,.45)}
    .cap{position:absolute;left:-8px;top:50%;translate:0 -50%;width:18px;height:18px;border-radius:50%;background:linear-gradient(180deg,#4e556a,#262a33);border:1px solid #6b7388}
    .ticks{position:relative;display:flex;justify-content:space-between;align-items:flex-start;margin-top:10px;padding:0 2px}
    .tick{position:relative;width:1px;background:#3a3d47}
    .tick.minor{height:10px;opacity:.55}
    .tick.major{height:16px}
    .tick .n{position:absolute;top:18px;left:50%;transform:translateX(-50%);font-size:12px;color:var(--muted)}
    .cursor{position:absolute;top:-8px;width:2px;background:var(--accent-2);height:52px;border-radius:2px;box-shadow:0 0 0 2px rgba(37,208,166,.15)}

    .note{font-size:13px;color:var(--muted)}
    .result{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:26px}
    .chip{background:#0c0d11;border:1px solid #2a2c33;border-radius:12px;padding:10px 12px}
    .chip .k{color:var(--muted);font-size:12px}
    .chip .v{font-weight:800;font-size:18px}
    .warn{color:var(--error);font-weight:700}
    footer{margin-top:26px;color:var(--muted);font-size:12px}
    a{color:#8fb6ff}
  </style>
</head>
<body>
  <!-- Hero banner at top with tighter spacing (12px) -->
  <img src="IMG_20250926_184644.png" alt="SUBQ SOCIETY – THE UNDERGROUND PROTOCOL" style="max-width:100%;height:auto;display:block;margin:0 auto 12px auto;">

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">
          <img src="IMG_20250926_184642.png" alt="Snake syringe logo" />
        </div>
        <h1>Peptide Calculator</h1>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: Inputs -->
      <section class="card" aria-labelledby="inputsTitle">
        <h2 id="inputsTitle" class="big" style="margin:6px 0 12px">Setup</h2>
        <div class="row">
          <div class="field sm">
            <label for="vialMg">Peptide per vial (mg)</label>
            <input id="vialMg" class="input" type="number" step="0.1" value="5" />
          </div>
          <div class="field sm">
            <label for="diluentMl">Diluent added (mL)</label>
            <input id="diluentMl" class="input" type="number" step="0.1" value="1" />
          </div>
          <div class="field sm">
            <label for="syrSize">Syringe size (units scale)</label>
            <select id="syrSize" class="input">
              <option value="30">30-unit (short)</option>
              <option value="50">50-unit</option>
              <option value="100" selected>100-unit</option>
            </select>
          </div>

          <!-- Desired dose with unit toggle -->
          <!-- CHANGED: added 'dose' class here -->
          <div class="field sm dose">
            <label for="doseVal">Desired dose</label>
            <div class="dose-group">
              <input id="doseVal" class="input" type="number" step="0.001" min="0" value="0.5" inputmode="decimal" placeholder="Enter dose" />
              <select id="doseUnit" class="input unit-select">
                <option value="mcg">mcg</option>
                <option value="mg" selected>mg</option>
              </select>
            </div>
          </div>
        </div>

        <div style="margin-top:10px">
          <label>Quick select dose</label>

          <!-- mcg presets -->
          <div id="presets-mcg" class="btns" role="group" aria-label="Preset doses (mcg)" style="display:none">
            <button class="pill preset" data-dose="50" data-unit="mcg" aria-pressed="true">50 mcg</button>
            <button class="pill preset" data-dose="100" data-unit="mcg">100 mcg</button>
            <button class="pill preset" data-dose="250" data-unit="mcg">250 mcg</button>
            <button class="pill preset" data-dose="500" data-unit="mcg">500 mcg</button>
          </div>

          <!-- mg presets -->
          <div id="presets-mg" class="btns" role="group" aria-label="Preset doses (mg)">
            <button class="pill preset" data-dose="1" data-unit="mg" aria-pressed="true">1 mg</button>
            <button class="pill preset" data-dose="2" data-unit="mg">2 mg</button>
            <button class="pill preset" data-dose="5" data-unit="mg">5 mg</button>
            <button class="pill preset" data-dose="10" data-unit="mg">10 mg</button>
          </div>
        </div>

        <p class="note" style="margin-top:10px">Assumes a U-100 insulin syringe where <strong>1 unit = 0.01 mL</strong>. Calculations update as you type.</p>
      </section>

      <!-- RIGHT: Syringe / Results -->
      <section class="card" aria-labelledby="visTitle">
        <h2 id="visTitle" class="big" style="margin:6px 0 12px">Visual Aid</h2>

        <div class="syringe" aria-live="polite">
          <h3>
            To have a dose of
            <span id="doseOut">0.5</span>
            <span id="doseUnitLabel">mg</span>
            pull the syringe to
            <span id="unitsOut">—</span>
            <span id="unitWord">units</span>
          </h3>
          <div class="tube" id="tube">
            <div class="fill" id="fill"></div>
            <div class="cap" aria-hidden="true"></div>
            <div class="cursor" id="cursor" aria-hidden="true"></div>
          </div>
          <div class="ticks" id="ticks" aria-hidden="true"></div>

          <div class="result">
            <div class="chip">
              <div class="k">Units to pull</div>
              <div class="v" id="unitsOutChip">—</div>
              <div class="k" style="margin-top:4px">≈ <span id="mlOut">—</span></div>
            </div>
            <div class="chip">
              <div class="k">Potency</div>
              <div class="v" id="potencyOut">—</div>
              <div class="k"><span id="potencyUnitLabel">mg</span> per unit</div>
            </div>
          </div>
          <p id="warn" class="note" style="margin-top:8px"></p>
        </div>

        <footer>
          <p class="note">This calculator is for educational use only. Not medical advice.</p>
        </footer>
      </section>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const $ = (id) => document.getElementById(id);

      // Inputs
      const vialMg = $('vialMg');
      const diluentMl = $('diluentMl');
      const syrSize  = $('syrSize');
      const doseVal  = $('doseVal');
      const doseUnit = $('doseUnit');

      // Outputs
      const doseOut = $('doseOut');
      const doseUnitLabel = $('doseUnitLabel');
      const unitsOut = $('unitsOut');
      const unitWord = $('unitWord');
      const mlOut = $('mlOut');
      const potencyOut = $('potencyOut');
      const potencyUnitLabel = $('potencyUnitLabel');
      const unitsOutChip = $('unitsOutChip');
      const ticks = $('ticks');
      const fill = $('fill');
      const cursor = $('cursor');
      const warnEl = $('warn');

      // Preset rows
      const presetsMcg = $('presets-mcg');
      const presetsMg  = $('presets-mg');

      const clamp=(n,min,max)=>Math.min(max,Math.max(min,n));
      const fmt=(n,d=2)=>Number.isFinite(n)?n.toFixed(d).replace(/\.0+$/,'').replace(/(\.[1-9]*)0+$/,'$1'):'—';

      function buildTicks(){
        ticks.innerHTML='';
        const max=parseInt(syrSize.value,10)||30;
        const minorStep=(max<=30?1:5);
        const majorStep=(max<=30?5:10);
        for(let i=0;i<=max;i+=minorStep){
          const t=document.createElement('div');
          t.className='tick '+(i%majorStep===0?'major':'minor');
          if(i%majorStep===0){
            const n=document.createElement('div'); n.className='n'; n.textContent=String(i); t.appendChild(n);
          }
          ticks.appendChild(t);
        }
      }

      // Normalize desired dose to mcg for math
      function getDesiredDoseMcg(){
        const val = parseFloat(doseVal.value);
        if(!Number.isFinite(val) || val <= 0) return NaN;
        return (doseUnit.value === 'mg') ? val * 1000 : val;
      }

      function recalc(){
        const mg=parseFloat(vialMg.value);
        const ml=parseFloat(diluentMl.value);
        const maxUnits=parseInt(syrSize.value,10)||30;

        // concentration mg/mL
        const conc = (mg>0 && ml>0) ? (mg/ml) : NaN;

        // mcg per unit (U-100 => 1U = 0.01 mL => mg/unit = conc*0.01; mcg/unit = mg/unit * 1000 = conc*10)
        const mcgPerUnit = Number.isFinite(conc) ? conc * 10 : NaN;
        const mgPerUnit  = Number.isFinite(mcgPerUnit) ? (mcgPerUnit/1000) : NaN;

        const desiredMcg = getDesiredDoseMcg();
        const units = (Number.isFinite(mcgPerUnit) && Number.isFinite(desiredMcg)) ? (desiredMcg / mcgPerUnit) : NaN;
        const mlToPull = Number.isFinite(units) ? units*0.01 : NaN;

        // Update header dose and unit + potency units
        if(doseUnit.value === 'mg'){
          doseOut.textContent = fmt(desiredMcg/1000,3); // mg
          doseUnitLabel.textContent = 'mg';
          potencyOut.textContent = Number.isFinite(mgPerUnit) ? fmt(mgPerUnit,4) : '—';
          potencyUnitLabel.textContent = 'mg';
        } else {
          doseOut.textContent = fmt(desiredMcg,0); // mcg
          doseUnitLabel.textContent = 'mcg';
          potencyOut.textContent = Number.isFinite(mcgPerUnit) ? fmt(mcgPerUnit,2) : '—';
          potencyUnitLabel.textContent = 'mcg';
        }

        unitsOut.textContent = fmt(units,2);
        unitsOutChip.textContent = Number.isFinite(units)?fmt(units,2):'—';
        mlOut.textContent = Number.isFinite(mlToPull) ? `${fmt(mlToPull,3)} mL` : '—';
        if(Number.isFinite(units)) unitWord.textContent = Math.abs(units-1)<0.005 ? 'unit' : 'units';

        const pct=Number.isFinite(units)?clamp(units/maxUnits*100,0,100):0;
        fill.style.width=pct+'%';
        cursor.style.left=`calc(${pct}% - 1px)`;

        warnEl.textContent=''; warnEl.classList.remove('warn');
        if(!Number.isFinite(units)){
          warnEl.textContent='Enter positive values for vial mg, diluent mL, and dose.';
        } else if(units>maxUnits){
          warnEl.textContent=`⚠️ Dose exceeds the selected syringe scale of ${maxUnits} units.`; warnEl.classList.add('warn');
        }
      }

      // Handle preset clicks within a given row
      function wirePresets(row){
        row.querySelectorAll('.preset').forEach(btn=>{
          btn.addEventListener('click',()=>{
            // clear pressed in both rows
            document.querySelectorAll('.preset').forEach(b=>b.setAttribute('aria-pressed','false'));
            btn.setAttribute('aria-pressed','true');

            // set value and unit from the clicked button
            doseUnit.value = btn.dataset.unit;
            doseVal.value  = btn.dataset.dose;

            // toggle rows visibility to match unit
            togglePresetRows();
            recalc();
          });
        });
      }

      function togglePresetRows(){
        const useMg = (doseUnit.value === 'mg');
        presetsMg.style.display  = useMg ? 'flex' : 'none';
        presetsMcg.style.display = useMg ? 'none' : 'flex';

        // Update labels (potency label gets set again in recalc)
        doseUnitLabel.textContent   = useMg ? 'mg'  : 'mcg';
        potencyUnitLabel.textContent= useMg ? 'mg'  : 'mcg';
      }

      // When unit changes via dropdown: convert existing number to keep the same absolute dose
      function convertOnUnitChange(prevUnit, nextUnit){
        const val = parseFloat(doseVal.value);
        if(!Number.isFinite(val)) return;
        if(prevUnit === nextUnit) return;
        if(prevUnit === 'mcg' && nextUnit === 'mg'){
          doseVal.value = (val/1000).toString();
        } else if(prevUnit === 'mg' && nextUnit === 'mcg'){
          doseVal.value = (val*1000).toString();
        }
      }

      // Events: inputs trigger recalc
      ['input','change'].forEach(evt=>{
        [vialMg,diluentMl,syrSize,doseVal].forEach(el=>{
          el.addEventListener(evt,()=>{
            if(el!==doseVal){
              document.querySelectorAll('.preset').forEach(b=>b.setAttribute('aria-pressed','false'));
            }
            if(el===syrSize) buildTicks();
            recalc();
          });
        });
      });

      // Unit dropdown change
      doseUnit.addEventListener('change', ()=>{
        const prev = (doseUnit.dataset.prev || 'mcg');
        const next = doseUnit.value;
        convertOnUnitChange(prev, next);
        doseUnit.dataset.prev = next;
        togglePresetRows();
        // clear preset selection when switching unit
        document.querySelectorAll('.preset').forEach(b=>b.setAttribute('aria-pressed','false'));
        recalc();
      });

      // Wire preset rows
      wirePresets(presetsMcg);
      wirePresets(presetsMg);

      // Init
      doseUnit.dataset.prev = doseUnit.value; // remember starting unit
      buildTicks();
      togglePresetRows();
      recalc();
    });
  </script>
</body>
</html>
